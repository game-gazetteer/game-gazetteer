<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Gazetteer â€“ Interactive Maps Hub</title>
    <link rel="icon" type="image/png" href="thumbnails/favicon.png">

    <!-- Google Fonts (Old-style serif) -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=IM+Fell+English&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            padding: 0p4x;
            font-family: "IM Fell English", serif;
            /*background: url('assets/par.jp') repeat center center; */
            /* If texture fails, fallback */
            background-color: #e7d8b1;
            color: #3a2d17;
        }

        h1 {
            text-align: center;
            font-size: 4em;
            margin-bottom: 0;
            font-family: "Cinzel", serif;
            text-shadow: 0 0 8px #f7f1dc;
        }

        .subtitle {
            text-align: center;
            font-size: 1.3em;
            margin-bottom: 40px;
        }

        /* SEARCH BAR */
        .search-container {
            text-align: center;
            margin-bottom: 40px;
        }

        .search-container input {
            width: 320px;
            padding: 12px;
            border-radius: 6px;
            border: 2px solid #6a5331;
            background: #f4e7c5;
            font-size: 1.2em;
            font-family: "IM Fell English", serif;
        }

        /* GRID */
        .grid {
            max-width: 1200px;
            margin: auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, 260px);
            gap: 30px;
            justify-content: center;
        }

        /* MAP CARDS */
        .map-card {
            background: rgba(255, 245, 214, 0.9);
            border: 2px solid #5e4729;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 0 10px rgba(70, 50, 20, 0.4);
            cursor: pointer;
            transition: 0.2s;
        }

        .map-card:hover {
            transform: scale(1.03);
            box-shadow: 0 0 15px rgba(70, 50, 20, 0.6);
        }

        .map-card img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            border: 2px solid #5e4729;
            border-radius: 6px;
        }

        .title {
            text-align: center;
            margin-top: 10px;
            font-size: 1.4em;
            font-weight: bold;
            font-family: "Cinzel", serif;
        }

        .header {
            display: flex;
            align-items: center; /* vertically center logo with text */
            justify-content: center; /* center the whole header horizontally */
            gap: 15px; /* space between logo and text */
            margin-top: 20px;
        }

        .header h1 {
            font-size: 4em;
            font-family: "Cinzel", serif;
            text-shadow: 0 0 8px #f7f1dc;
            margin: 0; /* remove default margin */
            line-height: 1; /* ensures vertical alignment works better */
        }

        .header .logo {
            height: 5em; /* match text height */
            width: auto; /* maintain aspect ratio */
        }

    </style>
</head>

<body>

    <div class="header">
        <img src="thumbnails/logo.png" alt="Game Gazetteer Logo" class="logo">
        <h1>Game Gazetteer</h1>
    </div>
    <div class="subtitle">A Collection of Interactive Game Maps</div>

    <!-- SEARCH -->
    <div class="search-container">
        <input type="text" id="search" placeholder="Search maps...">
    </div>

    <button id="auth-btn" style="
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 8px 16px;
        font-family: 'IM Fell English', serif;
        font-size: 1em;
        border-radius: 6px;
        border: 2px solid #6a5331;
        background: #f4e7c5;
        cursor: pointer;
        z-index: 1000;
    ">Login</button>

    <!-- GRID -->
    <div class="grid" id="mapGrid">

        <!-- SAMPLE CARDS (Replace with your own) -->
        <div class="map-card" data-title="Cuphead" onclick="location.href='cuphead'">
            <img src="thumbnails/cuphead.png" alt="Cuphead">
            <div class="title">Cuphead</div>
        </div>

        <div class="map-card" data-title="Celeste">
            <img src="thumbnails/placeholder.png" alt="Placeholder">
            <div class="title">Upcoming: Celeste</div>
        </div>

    </div>

    <script>
        // LIVE SEARCH
        const searchInput = document.getElementById("search");
        const mapCards = document.querySelectorAll(".map-card");

        searchInput.addEventListener("input", () => {
            const q = searchInput.value.toLowerCase();
            mapCards.forEach(card => {
                const title = card.getAttribute("data-title").toLowerCase();
                card.style.display = title.includes(q) ? "block" : "none";
            });
        });
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyBGI-tSZjsy7wvNSu3D_lFZR96TQND-uJU",
            authDomain: "gamegazetteer-bfed2.firebaseapp.com",
            projectId: "gamegazetteer-bfed2",
            storageBucket: "gamegazetteer-bfed2.appspot.com",
            messagingSenderId: "659845857638",
            appId: "1:659845857638:web:7ad66baffa924961a948a7",
            measurementId: "G-Q8QP2RD1BL"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth();
        const db = getFirestore();

        // Google provider
        const provider = new GoogleAuthProvider();

        // Button reference
        const authBtn = document.getElementById('auth-btn');

        // Click handler
        authBtn.addEventListener('click', async () => {
            if (auth.currentUser) {
                // Sign out
                await signOut(auth);
                alert('Signed out');
            } else {
                // Sign in with Google popup
                try {
                    const result = await signInWithPopup(auth, provider);
                    const user = result.user;
                    console.log('Logged in as:', user.email);
                } catch (err) {
                    alert('Error: ' + err.message);
                }
            }
        });

        // Update button text based on auth state
        onAuthStateChanged(auth, user => {
            if (user) {
                authBtn.innerText = 'Sign Out';
                // Load user progress
                loadUserProgress(user.uid);
            } else {
                authBtn.innerText = 'Login';
            }
        });

        // Firestore save/load functions
        async function saveUserProgress(uid, progress) {
            await setDoc(doc(db, 'users', uid), progress, { merge: true });
        }

        async function loadUserProgress(uid) {
            const docSnap = await getDoc(doc(db, 'users', uid, 'progress', 'userSettings'));
            if (docSnap.exists()) {
                const data = docSnap.data();
                console.log('Loaded progress:', data);
                // Example: apply to map
                // map.setView([data.mapCenter.lat, data.mapCenter.lng], data.zoom);
            }
        }
    </script>


</body>
</html>
